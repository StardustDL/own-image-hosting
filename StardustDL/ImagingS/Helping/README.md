# ImagingS 使用说明

## 一、运行环境

运行时需要的依赖包：

```
numpy==1.19.0
Pillow==7.1.2
PyQt5==5.15.0
qtawesome==0.7.2
```

其中 qtawesome 用于显示各种图标。

## 二、启动方式

### GUI

在项目根目录下执行：

```sh
python -m ImagingS.Gui
```

### CLI

在项目根目录下执行：

```sh
python -m ImagingS.Cli input.txt output_dir
```

## 三、操作说明

### 3.1 程序启动和文档创建与保存

![](images/1.png)

程序启动时没有创建文档，所有按钮都处于不可用状态。点击 File 菜单（或按快捷键 Alt+F），选择 New 创建新文档（也可直接使用 快捷键 Ctrl+N）。

![](images/2.png)

会弹出对话框询问画布大小：

![](images/3.png)

输入大小后按确定即可创建文档。创建新文档后的界面如下，可以看到所有功能均可用。

![](images/4.png)

可以使用快捷键 Ctrl+S 保存文档，会弹出保存文件对话框。

![](images/5.png)

这里可以选择两种保存类型，一种是 .isd 文件，为压缩后的二进制文档，一种是 .isd.json 为文本化的文档，可读性强。

保存后可以看到软件标题栏已经变为保存路径。

![](images/6.png)

使用 File 菜单下的 Close 命令可以关闭文档，如果当前有未保存的更改，将弹出对话框请求确认。

![](images/7.png)

可以使用 Ctrl+O 快捷键打开已保存的文档：

![](images/8.png)

### 3.2 撤销与重做

绘制图元后，可以在 Edit 菜单进行撤销和重做操作：

![](images/9.png)

![](images/10.png)

如果内存足够，可支持无限步数的撤销和重做。

### 3.3 文档代码编辑

打开文档后，进入 View 菜单，选择 Code 命令（或者使用快捷键 Ctrl+Shift+C）进入代码编辑状态，在这里可以拥有对文档的完全编辑能力，一些可视化编辑无法处理的操作也可以在代码中实现。

![](images/12.png)

在这里可以看到文档的源代码，并进行编辑。左侧工具栏的三个按钮分别是：文档结构图，放弃当前编辑，应用当前编辑。

编辑完成后，点击左侧对勾按钮即可应用编辑结果，可以切换回 Visual 模式查看效果。

点击文档结构图按钮可以查看当前文档的结构图：

![](images/13.png)

这里能更直观的看到文档中每个对象和它们的属性。一些属性也支持直接在文档结构图上编辑，更加方便。

![](images/14.png)

### 3.4 文档可视化编辑

打开文档后，进入 View 菜单，选择 Visual 命令（或者使用快捷键 Ctrl+Shift+V）进入可视化编辑状态。

可以使用鼠标点击来选择当前操作的图元，多个图元重叠时，只选择最上层图元。

画布右键菜单中可以显示网格来辅助绘图。

#### 3.4.1 画刷

Brush 菜单包含了支持的画刷，Solid 为纯色画刷。右侧的 Brushes 窗格列出了当前文档中的画刷和它的十六进制表示。点击画刷后，下方的 Properties 窗格会显示选择的画刷的具体属性信息。

![](images/16.png)

点击 Solid 命令可以创建新画刷。

![](images/17.png)

右键点击画刷，可以删除画刷或清空画刷集合。

#### 3.4.2 图元编辑

Drawing 菜单包含了所有图元，左侧工具栏提供了相应的快捷方式。右侧的 Drawings 窗格列出了当前文档中有的图元和标识，双击标识可以更改标识名，选择图元后可以在 Properties 窗格查看具体信息。

![](images/15.png)
![](images/21.png)

创建图元前，如果在 Brushes 窗格选择了一个画刷，那么新创建的图元就会使用这个画刷，否则使用默认画刷。

右键点击图元，可以删除图元或清空画布。

![](images/22.png)

选择图元命令进入绘制模式时，可以按 Esc 放弃绘制并退出绘制模式。

#### 3.4.3 绘制线段

点击线段图元命令，将弹出对话框选择绘制算法。

![](images/18.png)

选择后进入绘制模式，在画布上点击确定起点，移动指针可看到线段随指针位置变化。

![](images/19.png)

再次点击确定终点，完成绘制。可以在右侧 Drawings 窗格看到新绘制的图元。

![](images/20.png)

按住 Shift 后移动鼠标，可以强制线段水平或垂直。

![](images/30.png)

#### 3.4.4 绘制多边形

点击封闭（非封闭）多边形命令，将弹出对话框选择绘制算法。选择后进入绘制状态。在画布上点击确定起点，移动指针可看到线段随指针位置变化。每次单击都会创建一个新的顶点，当需要绘制最后一个顶点时，双击鼠标即可完成绘制。

![](images/25.png)

#### 3.4.5 绘制矩形

点击矩形命令，将弹出对话框选择绘制算法。选择后进入绘制状态。在画布上点击确定起点，移动指针可看到矩形随指针位置变化。再次点击确定终点，完成绘制。

![](images/26.png)

按住 Shift 后移动鼠标，可以强制矩形为正方形。

![](images/31.png)

#### 3.4.6 绘制曲线

点击曲线图元命令，将弹出对话框选择绘制算法。

![](images/27.png)

选择后进入绘制模式，在画布上点击确定起点，每次单击都会创建一个新的顶点，当需要绘制最后一个顶点时，双击鼠标即可完成绘制。绘制过程中移动指针可看到曲线随指针位置变化。

对于曲线，在已确定三个控制点的时候才会实际绘制，所以前两次鼠标单击不会在画布上产生实际内容，第三次点击后才会开始绘制实际内容。

贝塞尔曲线：

![](images/28.png)

B 样条曲线：

![](images/29.png)

#### 3.4.7 绘制椭圆

点击椭圆图元命令，进入绘制状态。在画布上点击确定起点，移动指针可看到椭圆随指针位置变化。再次点击确定终点，完成绘制。

![](images/32.png)

按住 Shift 后移动鼠标，可以强制椭圆为圆。

![](images/33.png)

#### 3.4.8 变换编辑

Transform 菜单包含了所有变换，左侧工具栏提供了相应的快捷方式。右侧的 Transform 窗格列出了当前选择的图元所应用的变换，选择变换后可以在 Properties 窗格查看具体信息。

![](images/34.png)
![](images/35.png)

右键点击变换，可以删除变换或清空当前图元的所有变换。

![](images/36.png)

选择变换命令进入绘制模式时，可以按 Esc 放弃绘制并退出绘制模式。

#### 3.4.8 平移变换

在 Drawings 窗格选择图元，点击平移变换命令，进入绘制模式。

![](images/37.png)

在画布上单击，确定起点。可以看到画布上标出了起点和指示平移方向和大小的辅助线。

![](images/38.png)

移动指针，可以看到辅助线和图元同步运动。再次单击画布确定终点，完成绘制。

![](images/39.png)

与绘制线段相似，使用 Shift 可以强制水平平移或垂直平移。

![](images/40.png)

#### 3.4.9 缩放变换

在 Drawings 窗格选择图元，点击缩放变换命令，进入绘制模式。

![](images/41.png)

在画布上单击，确定缩放中心。可以看到画布上标出了中心和指示缩放比例的辅助网格。

![](images/42.png)

缩放变换支持 X,Y 不同比例缩放，辅助坐标轴上的点反映了两维各自的缩放倍数。

X 轴上的七个点从左到右依次为缩小3倍，缩小2倍，缩小1倍，不变，放大1倍，放大2倍，放大3倍。
Y 轴上的七个点从上到下依次为缩小3倍，缩小2倍，缩小1倍，不变，放大1倍，放大2倍，放大3倍。

移动指针可以看到当前缩放比例和图元实际效果。再次单击完成绘制。

![](images/43.png)

使用 Shift 可以强制 X,Y 同比例缩放。

![](images/44.png)

#### 3.4.9 旋转变换

在 Drawings 窗格选择图元，点击旋转变换命令，进入绘制模式。

![](images/45.png)

在画布上单击，确定旋转中心。可以看到画布上标出了中心和指示旋转角度的辅助扇形。

![](images/46.png)

移动指针可以看到当前旋转角度和图元实际效果。再次单击完成绘制。

使用 Shift 可以强制旋转 90° 的整数倍。

![](images/47.png)

#### 3.4.10 倾斜变换

在 Drawings 窗格选择图元，点击倾斜变换命令，进入绘制模式。

![](images/48.png)

在画布上单击，确定倾斜中心。可以看到画布上标出了中心和指示X轴倾斜角度的辅助扇形，中间线右侧为正，左侧为负。

![](images/49.png)

移动指针可以看到当前倾斜角度和图元实际效果。再次单击完成 X 轴倾斜角度的设置，进入 Y 轴设置状态。

![](images/50.png)

移动指针可以看到当前倾斜角度和图元实际效果。再次单击完成绘制。

由于倾斜角度极大时变换点过远，所以限制倾斜角度绝对值在60°以内。

#### 3.4.11 矩阵变换

上述四种变换均可转化为齐次坐标下的矩阵变换。使用矩阵变换可以创建更复杂的变换。在 Drawings 窗格选择图元，点击矩阵变换命令，弹出对话框输入矩阵。

![](images/51.png)

点击确定即可创建矩阵变换。

#### 3.4.12 复合变换

当需要对同一个图元依次应用多个变换时，使用复合变换。在 Drawings 窗格选择图元，点击复合变换命令，即可为当前图元创建复合变换。之后对该图元使用上述五种基本变换都会加入到复合变换列表中。

![](images/52.png)

#### 3.5 线段裁剪

在 Drawings 窗格选择线段图元，点击裁剪命令，将弹出对话框选择裁剪算法。

![](images/57.png)

选择后进入绘制模式，在画布上点击确定起点，移动指针可看到裁剪框随指针位置变化，再次点击确定裁剪范围，完成裁剪。

若裁剪结果为空，此图元会被删除。

裁剪后的图元将清空变换列表。

![](images/55.png)
![](images/56.png)

### 3.5 图片导出

在 File 菜单下选择 Export 命令，弹出导出对话框，有三种导出格式可以选择。

![](images/53.png)
